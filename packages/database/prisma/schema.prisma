generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Vehicle {
  id                String              @id @default(uuid())
  vin               String              @unique
  make              String
  model             String
  year              Int
  type              VehicleType
  color             String?
  plate             String?
  mileage           Int?
  status            VehicleStatus       @default(AVAILABLE)
  ownerID           String?             @map("owner_id")
  lastServiceDate   DateTime?           @map("last_service_date")
  nextServiceDate   DateTime?           @map("next_service_date")
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  
  // 관계
  owner             User?               @relation(fields: [ownerID], references: [id])
  maintenanceRecords MaintenanceRecord[]
  documents         VehicleDocument[]
  telemetry         Telemetry?

  @@map("vehicles")
}

enum VehicleType {
  SEDAN
  SUV
  TRUCK
  VAN
  ELECTRIC
  HYBRID
}

enum VehicleStatus {
  AVAILABLE
  MAINTENANCE
  RESERVED
  INACTIVE
  RECALLED
}

model MaintenanceRecord {
  id          String               @id @default(uuid())
  vehicleID   String               @map("vehicle_id")
  description String
  date        DateTime
  mileage     Int?
  cost        Float?
  performedBy String?              @map("performed_by")
  status      MaintenanceStatus    @default(SCHEDULED)
  notes       String?
  createdAt   DateTime             @default(now()) @map("created_at")
  updatedAt   DateTime             @updatedAt @map("updated_at")
  
  // 관계
  vehicle     Vehicle              @relation(fields: [vehicleID], references: [id])
  parts       MaintenancePart[]
  documents   MaintenanceDocument[]

  @@map("maintenance_records")
}

enum MaintenanceStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model MaintenancePart {
  id              String            @id @default(uuid())
  maintenanceID   String            @map("maintenance_id")
  name            String
  partNumber      String?           @map("part_number")
  quantity        Int               @default(1)
  unitCost        Float?            @map("unit_cost")
  totalCost       Float?            @map("total_cost")
  
  // 관계
  maintenance     MaintenanceRecord @relation(fields: [maintenanceID], references: [id])

  @@map("maintenance_parts")
}

model VehicleDocument {
  id          String    @id @default(uuid())
  vehicleID   String    @map("vehicle_id")
  name        String
  type        String
  fileURL     String    @map("file_url")
  uploadDate  DateTime  @default(now()) @map("upload_date")
  expiryDate  DateTime? @map("expiry_date")
  size        Int?
  
  // 관계
  vehicle     Vehicle   @relation(fields: [vehicleID], references: [id])

  @@map("vehicle_documents")
}

model MaintenanceDocument {
  id            String           @id @default(uuid())
  maintenanceID String           @map("maintenance_id")
  name          String
  type          String
  fileURL       String           @map("file_url")
  uploadDate    DateTime         @default(now()) @map("upload_date")
  size          Int?
  
  // 관계
  maintenance   MaintenanceRecord @relation(fields: [maintenanceID], references: [id])

  @@map("maintenance_documents")
}

model Telemetry {
  id              String    @id @default(uuid())
  vehicleID       String    @unique @map("vehicle_id")
  connectionStatus String    @map("connection_status")
  lastPing        DateTime? @map("last_ping")
  batteryLevel    Float?    @map("battery_level")
  fuelLevel       Float?    @map("fuel_level")
  engineTemp      Float?    @map("engine_temp")
  oilLevel        Float?    @map("oil_level")
  latitude        Float?
  longitude       Float?
  diagnosticCodes String[]  @map("diagnostic_codes")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  
  // 관계
  vehicle         Vehicle   @relation(fields: [vehicleID], references: [id])

  @@map("telemetry")
}

model User {
  id        String      @id @default(uuid())
  email     String      @unique
  name      String
  password  String
  role      UserRole    @default(CUSTOMER)
  isActive  Boolean     @default(true) @map("is_active")
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")
  
  // 관계
  vehicles   Vehicle[]
  profile    UserProfile?

  @@map("users")
}

enum UserRole {
  ADMIN
  MANAGER
  TECHNICIAN
  CUSTOMER
}

model UserProfile {
  id        String   @id @default(uuid())
  userID    String   @unique @map("user_id")
  phone     String?
  address   String?
  company   String?
  avatarURL String?  @map("avatar_url")
  
  // 관계
  user      User     @relation(fields: [userID], references: [id])

  @@map("user_profiles")
} 